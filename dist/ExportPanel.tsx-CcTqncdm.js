import{u as x,j as n}from"./assets/index-DNcHv8Gn.js";import{R as y}from"./chunk-DJ1oPbzn.js";import"./chunk-B6LuprgX.js";function r(c,u,o="text/plain"){const m=new Blob([u],{type:o+";charset=utf-8"}),l=URL.createObjectURL(m),a=document.createElement("a");a.href=l,a.download=c,document.body.appendChild(a),a.click(),a.remove(),URL.revokeObjectURL(l)}const E=({engine:c,onImported:u})=>{const o=x(),m=()=>{const e=c.serialize();r(`backup-${Date.now()}.json`,JSON.stringify(e,null,2),"application/json"),o.show("バックアップを保存しました","success")},l=async e=>{var t;const s=(t=e.target.files)==null?void 0:t[0];if(s)try{const i=await s.text(),j=JSON.parse(i);c.restore(j),u(),o.show("バックアップから復元しました","success")}catch(i){o.show(`復元に失敗: ${i.message??String(i)}`,"danger")}finally{e.target.value=""}},a=()=>{const e=c.getTrialBalance(),s=["code,name,debit,credit"];e.accounts.forEach(t=>{s.push([t.code,t.name,t.debitBalance,t.creditBalance].join(","))}),r("trial-balance.csv",s.join(`
`),"text/csv"),o.show("試算表CSVを出力しました","success")},p=()=>{o.show("Excel出力は一時的に無効化されています。CSVをご利用ください。","warning")},b=()=>{const e=c.getIncomeStatement(),s=["type,code,name,amount"];e.revenues.forEach(t=>s.push(["revenue",t.code,t.name,t.amount].join(","))),e.expenses.forEach(t=>s.push(["expense",t.code,t.name,t.amount].join(","))),s.push(["total","","totalRevenue",e.totalRevenue].join(",")),s.push(["total","","totalExpense",e.totalExpense].join(",")),s.push(["total","","netIncome",e.netIncome].join(",")),r("income-statement.csv",s.join(`
`),"text/csv"),o.show("損益計算書CSVを出力しました","success")},h=()=>{const e=c.getBalanceSheet(),s=["section,code,name,amount"];e.assets.forEach(t=>s.push(["asset",t.code,t.name,t.amount].join(","))),e.liabilities.forEach(t=>s.push(["liability",t.code,t.name,t.amount].join(","))),e.equity.forEach(t=>s.push(["equity",t.code,t.name,t.amount].join(","))),s.push(["total","","totalAssets",e.totalAssets].join(",")),s.push(["total","","totalLiabilities",e.totalLiabilities].join(",")),s.push(["total","","totalEquity",e.totalEquity].join(",")),r("balance-sheet.csv",s.join(`
`),"text/csv"),o.show("貸借対照表CSVを出力しました","success")},d=y.useRef(null);return n.jsxs("div",{className:"card",style:{marginTop:12},children:[n.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",children:[n.jsx("strong",{children:"エクスポート/バックアップ"}),n.jsxs("div",{children:[n.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:m,children:"バックアップ保存"}),n.jsx("button",{className:"btn btn-sm btn-outline-primary ms-2",onClick:()=>{var e;return(e=d.current)==null?void 0:e.click()},children:"バックアップ復元"}),n.jsx("input",{ref:d,type:"file",accept:"application/json,.json",style:{display:"none"},onChange:l})]})]}),n.jsx("div",{className:"card-body",children:n.jsxs("div",{className:"btn-group",role:"group",children:[n.jsx("button",{className:"btn btn-sm btn-secondary",onClick:a,children:"試算表CSV"}),n.jsx("button",{className:"btn btn-sm btn-secondary",onClick:b,children:"損益計算書CSV"}),n.jsx("button",{className:"btn btn-sm btn-secondary",onClick:h,children:"貸借対照表CSV"}),n.jsx("button",{className:"btn btn-sm btn-success",onClick:p,children:"Excel出力(xlsx)"})]})})]})};export{E as ExportPanel};
