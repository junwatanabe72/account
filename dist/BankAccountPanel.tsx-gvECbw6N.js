import{j as e}from"./assets/index-DNcHv8Gn.js";import{r as c}from"./chunk-DJ1oPbzn.js";import{d as b}from"./chunk-xo-tfjFm.js";import{B as S}from"./chunk-D7WOVkBo.js";import"./chunk-B6LuprgX.js";const w=({type:p,message:i,onClose:l,duration:m=5e3})=>{c.useEffect(()=>{const d=setTimeout(()=>{l()},m);return()=>clearTimeout(d)},[m,l]);const n=()=>{switch(p){case"success":return"alert alert-success";case"error":return"alert alert-danger";case"warning":return"alert alert-warning";case"info":default:return"alert alert-info"}},t=()=>{switch(p){case"success":return"✅";case"error":return"❌";case"warning":return"⚠️";case"info":default:return"ℹ️"}};return e.jsx("div",{style:{position:"fixed",top:"20px",right:"20px",zIndex:9999,maxWidth:"500px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)"},children:e.jsxs("div",{className:`${n()} d-flex align-items-start`,children:[e.jsx("span",{style:{marginRight:"10px",fontSize:"1.2em"},children:t()}),e.jsx("div",{style:{flex:1},children:i.split(`
`).map((d,u)=>e.jsx("div",{children:d},u))}),e.jsx("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:l,style:{marginLeft:"10px",cursor:"pointer",background:"none",border:"none",fontSize:"1.2em"},children:"×"})]})})},B=({engine:p,onChanged:i})=>{const[l,m]=c.useState(b),[n,t]=c.useState(null),[d,u]=c.useState(!1),[j,N]=c.useState(!1),[r]=c.useState(()=>new S(b)),[x,y]=c.useState(null),[g,o]=c.useState(null);c.useEffect(()=>{const s=a=>{m(r.getAccounts(!0)),i==null||i()};return r.addChangeListener(s),()=>{r.removeChangeListener(s)}},[r,i]);const f=c.useMemo(()=>j?l:l.filter(s=>s.isActive),[l,j]),A=()=>({id:`account_${Date.now()}`,code:"",name:"",shortName:"",accountType:"savings",division:"KANRI",bankName:"",branchName:"",accountNumber:"",accountHolder:"",balance:0,isActive:!0,description:"",displayOrder:l.length+1}),v=c.useCallback(s=>{var h;if(!s.success){o({type:"error",message:((h=s.errors)==null?void 0:h.join(`
`))||"処理に失敗しました"});return}let a="処理が完了しました。";s.affectedTransactions&&s.affectedTransactions.length>0&&(a+=`
${s.affectedTransactions.length}件の取引が影響を受けます。`),s.affectedAccounts&&s.affectedAccounts.length>1&&(a+=`
${s.affectedAccounts.length}件の関連口座が更新されました。`),s.errors&&s.errors.length>0?o({type:"warning",message:a+`
警告: `+s.errors.join(`
`)}):o({type:"success",message:a}),y(s)},[]),k=()=>{if(!n)return;if(!n.code||!n.name){o({type:"error",message:"口座コードと口座名は必須です"});return}let s;if(d)s=r.addAccount(n);else{const a=l.find(h=>h.id===n.id);if(a)s=r.updateAccount(a.code,n);else{o({type:"error",message:"更新対象の口座が見つかりません"});return}}v(s),s.success&&(t(null),u(!1))},T=s=>{const a=r.disableAccount(s.code);if(a.affectedTransactions&&a.affectedTransactions.length>0){const h=`${s.name}を非アクティブにしますか？

警告: この口座は${a.affectedTransactions.length}件の取引で使用されています。
非アクティブ化すると、これらの取引の決済口座として使用できなくなります。`;if(!confirm(h))return}else if(!confirm(`${s.name}を非アクティブにしますか？`))return;v(a)},C=s=>{const a=r.enableAccount(s.code);v(a)};return e.jsxs("div",{className:"bank-account-panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsx("h2",{children:"🏦 口座管理"}),e.jsxs("div",{className:"header-controls",children:[e.jsxs("label",{className:"show-inactive-toggle",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:s=>N(s.target.checked)}),"非アクティブも表示"]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>{t(A()),u(!0)},children:"➕ 新規口座追加"})]})]}),e.jsx("div",{className:"accounts-grid",children:e.jsxs("table",{className:"table table-striped",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"コード"}),e.jsx("th",{children:"口座名"}),e.jsx("th",{children:"種別"}),e.jsx("th",{children:"区分"}),e.jsx("th",{children:"銀行名"}),e.jsx("th",{children:"支店名"}),e.jsx("th",{children:"口座番号"}),e.jsx("th",{children:"状態"}),e.jsx("th",{children:"操作"})]})}),e.jsxs("tbody",{children:[f.map(s=>e.jsxs("tr",{className:s.isActive?"":"inactive",children:[e.jsx("td",{children:s.code}),e.jsx("td",{children:e.jsxs("div",{className:"account-name",children:[e.jsx("strong",{children:s.name}),s.shortName&&e.jsxs("span",{className:"short-name",children:["(",s.shortName,")"]})]})}),e.jsxs("td",{children:[s.accountType==="cash"&&"現金",s.accountType==="savings"&&"普通預金",s.accountType==="checking"&&"当座預金",s.accountType==="time_deposit"&&"定期預金"]}),e.jsx("td",{children:e.jsxs("span",{className:`division-badge ${s.division.toLowerCase()}`,children:[s.division==="KANRI"&&"管理",s.division==="SHUZEN"&&"修繕",s.division==="BOTH"&&"共通"]})}),e.jsx("td",{children:s.bankName||"-"}),e.jsx("td",{children:s.branchName||"-"}),e.jsx("td",{children:s.accountNumber||"-"}),e.jsx("td",{children:e.jsx("span",{className:`status-badge ${s.isActive?"active":"inactive"}`,children:s.isActive?"有効":"無効"})}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>{t(s),u(!1)},children:"編集"}),s.isActive?e.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>T(s),children:"無効化"}):e.jsx("button",{className:"btn btn-sm btn-outline-success",onClick:()=>C(s),children:"有効化"})]})})]},s.id)),f.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"text-center text-muted",children:j?"口座が登録されていません":"アクティブな口座がありません"})})]})]})}),n&&e.jsx("div",{className:"modal-backdrop",onClick:()=>t(null),children:e.jsxs("div",{className:"edit-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:d?"新規口座追加":"口座編集"}),e.jsx("button",{className:"close-btn",onClick:()=>t(null),children:"×"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["口座コード ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"text",value:n.code,onChange:s=>t({...n,code:s.target.value}),placeholder:"例: 1105"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["口座名 ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"text",value:n.name,onChange:s=>t({...n,name:s.target.value}),placeholder:"例: 普通預金（管理）"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"略称"}),e.jsx("input",{type:"text",value:n.shortName,onChange:s=>t({...n,shortName:s.target.value}),placeholder:"例: 管理口座"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"口座種別"}),e.jsxs("select",{value:n.accountType,onChange:s=>t({...n,accountType:s.target.value}),children:[e.jsx("option",{value:"cash",children:"現金"}),e.jsx("option",{value:"savings",children:"普通預金"}),e.jsx("option",{value:"checking",children:"当座預金"}),e.jsx("option",{value:"time_deposit",children:"定期預金"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"会計区分"}),e.jsxs("select",{value:n.division,onChange:s=>t({...n,division:s.target.value}),children:[e.jsx("option",{value:"KANRI",children:"管理会計"}),e.jsx("option",{value:"SHUZEN",children:"修繕会計"}),e.jsx("option",{value:"BOTH",children:"共通"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"銀行名"}),e.jsx("input",{type:"text",value:n.bankName||"",onChange:s=>t({...n,bankName:s.target.value}),placeholder:"例: 三菱UFJ銀行"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"支店名"}),e.jsx("input",{type:"text",value:n.branchName||"",onChange:s=>t({...n,branchName:s.target.value}),placeholder:"例: ○○支店"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"口座番号"}),e.jsx("input",{type:"text",value:n.accountNumber||"",onChange:s=>t({...n,accountNumber:s.target.value}),placeholder:"例: 1234567"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"名義人"}),e.jsx("input",{type:"text",value:n.accountHolder||"",onChange:s=>t({...n,accountHolder:s.target.value}),placeholder:"例: ○○マンション管理組合"})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:"説明・備考"}),e.jsx("textarea",{value:n.description||"",onChange:s=>t({...n,description:s.target.value}),rows:3,placeholder:"この口座の用途や注意事項など"})]})]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>t(null),children:"キャンセル"}),e.jsx("button",{className:"btn btn-primary",onClick:k,children:"保存"})]})]})}),x&&x.affectedTransactions&&x.affectedTransactions.length>0&&e.jsx("div",{className:"sync-result-details",children:e.jsxs("div",{className:"alert alert-warning",children:[e.jsx("h4",{children:"影響を受ける取引"}),e.jsxs("p",{children:[x.affectedTransactions.length,"件の取引が影響を受けます。"]}),e.jsxs("details",{children:[e.jsx("summary",{children:"詳細を表示"}),e.jsx("ul",{children:x.affectedTransactions.map(s=>e.jsxs("li",{children:["取引ID: ",s]},s))})]})]})}),g&&e.jsx(w,{type:g.type,message:g.message,onClose:()=>o(null)})]})};export{B as BankAccountPanel};
