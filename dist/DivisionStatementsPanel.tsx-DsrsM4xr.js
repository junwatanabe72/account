import{j as e}from"./assets/index-DNcHv8Gn.js";import{R as y}from"./chunk-DJ1oPbzn.js";import{g as S,D as A,L as C}from"./chunk-nbQFM0MW.js";import"./chunk-B6LuprgX.js";function m(d){return"¥"+d.toLocaleString()}const I=({value:d,onChange:x})=>{const i=S(A);return e.jsxs("div",{className:"d-flex align-items-center gap-2 mb-2",children:[e.jsx("label",{className:"form-label mb-0",children:"会計区分"}),e.jsx("select",{className:"form-select",style:{maxWidth:280},value:d,onChange:u=>x(u.target.value),children:i.map(u=>e.jsx("optgroup",{label:u.label,children:u.options.map(E=>{var N;const h=((N=Object.entries(C).find(([p,b])=>b===E.code))==null?void 0:N[0])||E.code;return e.jsx("option",{value:h,children:E.name},E.code)})},u.label))})]})},D=({value:d,onChange:x})=>e.jsxs("div",{className:"d-flex align-items-center gap-2 mb-2",children:[e.jsx("label",{className:"form-label mb-0",children:"年度"}),e.jsxs("select",{className:"form-select",style:{maxWidth:180},value:d,onChange:g=>x(g.target.value),children:[e.jsx("option",{value:"2024",children:"2024年度"}),e.jsx("option",{value:"2025",children:"2025年度"})]})]}),T=({engine:d,division:x,year:g})=>{const i=parseInt(g),u=`${i}-04-01`,E=`${i+1}-03-31`,h=new Map;d.journals.forEach(t=>{t.date>=u&&t.date<=E&&t.status==="POSTED"&&t.division===x&&t.details.forEach(s=>{const a=d.accounts.find(c=>c.code===s.accountCode);if(!a)return;let o=h.get(s.accountCode)||0;a.normalBalance==="DEBIT"?(o+=s.debitAmount||0,o-=s.creditAmount||0):(o-=s.debitAmount||0,o+=s.creditAmount||0),h.set(s.accountCode,o)})});const p=Array.from(h.entries()).map(([t,s])=>{const a=d.accounts.find(n=>n.code===t);return a?{...a,calculatedBalance:s}:null}).filter(t=>t!==null&&t.calculatedBalance!==0).map(t=>{const s=Math.abs(t.calculatedBalance);let a=0,n=0;return t.type==="EXPENSE"&&t.code.startsWith("6")&&console.log(`[試算表] 費用科目 ${t.code} ${t.name}: calculatedBalance=${t.calculatedBalance}`),t.type==="ASSET"||t.type==="EXPENSE"?t.calculatedBalance>0?a=s:n=s:t.calculatedBalance>0?n=s:a=s,{code:t.code,name:t.name,type:t.type,debit:a,credit:n}}).sort((t,s)=>t.code.localeCompare(s.code)),b=p.reduce((t,s)=>(t.debit+=s.debit,t.credit+=s.credit,t),{debit:0,credit:0}),j={資産の部:[],負債の部:[],正味財産の部:[],収益の部:[],費用の部:[]};return p.forEach(t=>{var a,n,o,c,l,r;const s=(a=d.accounts.find(f=>f.code===t.code))==null?void 0:a.type;if(s)switch(s){case"ASSET":(n=j.資産の部)==null||n.push(t);break;case"LIABILITY":(o=j.負債の部)==null||o.push(t);break;case"EQUITY":(c=j.正味財産の部)==null||c.push(t);break;case"REVENUE":(l=j.収益の部)==null||l.push(t);break;case"EXPENSE":(r=j.費用の部)==null||r.push(t);break}}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("strong",{children:"試算表（区分別）"})}),e.jsx("div",{className:"card-body",children:e.jsxs("table",{className:"table table-sm table-striped",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"勘定科目"}),e.jsx("th",{className:"text-end",children:"借方"}),e.jsx("th",{className:"text-end",children:"貸方"})]})}),e.jsx("tbody",{children:Object.entries(j).map(([t,s])=>s.length>0&&e.jsxs(y.Fragment,{children:[e.jsx("tr",{className:"bg-light",children:e.jsx("td",{colSpan:3,children:e.jsx("strong",{children:t})})}),s.map(a=>e.jsxs("tr",{children:[e.jsxs("td",{children:[a.code," - ",a.name]}),e.jsx("td",{className:"text-end text-primary",children:a.debit>0?m(a.debit):""}),e.jsx("td",{className:"text-end text-danger",children:a.credit>0?m(a.credit):""})]},a.code))]},t))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"table-light",children:[e.jsx("td",{children:e.jsx("strong",{children:"合計"})}),e.jsx("td",{className:"text-end text-primary",children:e.jsx("strong",{children:m(b.debit)})}),e.jsx("td",{className:"text-end text-danger",children:e.jsx("strong",{children:m(b.credit)})})]})})]})})]})},w=({engine:d,division:x,year:g})=>{const i=parseInt(g),u=`${i}-04-01`,E=`${i+1}-03-31`,h=[],N=[];let p=0,b=0;const j=new Map;d.journals.forEach(s=>{s.date>=u&&s.date<=E&&s.status==="POSTED"&&s.division===x&&s.details.forEach(a=>{const n=d.accounts.find(l=>l.code===a.accountCode);if(!n)return;let c=j.get(a.accountCode)||0;n.normalBalance==="DEBIT"?(c+=a.debitAmount||0,c-=a.creditAmount||0):(c-=a.debitAmount||0,c+=a.creditAmount||0),j.set(a.accountCode,c)})}),j.forEach((s,a)=>{const n=d.accounts.find(c=>c.code===a);if(!n||s===0)return;const o=Math.abs(s);n.type==="REVENUE"&&s>0&&(h.push({code:n.code,name:n.name,amount:o}),p+=o),n.type==="EXPENSE"&&s>0&&(N.push({code:n.code,name:n.name,amount:o}),b+=o)}),h.sort((s,a)=>s.code.localeCompare(a.code)),N.sort((s,a)=>s.code.localeCompare(a.code));const t=p-b;return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("strong",{children:"損益計算書（区分別）"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("h6",{className:"text-primary",children:"収益"}),e.jsx("table",{className:"table table-sm",children:e.jsxs("tbody",{children:[h.length===0?e.jsx("tr",{children:e.jsx("td",{className:"text-muted",children:"収益なし"})}):h.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.name}),e.jsx("td",{className:"text-end",children:m(s.amount)})]},s.code)),e.jsxs("tr",{className:"table-light",children:[e.jsx("td",{children:e.jsx("strong",{children:"収益合計"})}),e.jsx("td",{className:"text-end",children:e.jsx("strong",{children:m(p)})})]})]})})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("h6",{className:"text-danger",children:"費用"}),e.jsx("table",{className:"table table-sm",children:e.jsxs("tbody",{children:[N.length===0?e.jsx("tr",{children:e.jsx("td",{className:"text-muted",children:"費用なし"})}):N.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.name}),e.jsx("td",{className:"text-end",children:m(s.amount)})]},s.code)),e.jsxs("tr",{className:"table-light",children:[e.jsx("td",{children:e.jsx("strong",{children:"費用合計"})}),e.jsx("td",{className:"text-end",children:e.jsx("strong",{children:m(b)})})]})]})})]})]}),e.jsx("div",{className:"alert",style:{borderColor:t>=0?"#198754":"#dc3545",borderWidth:1,borderStyle:"solid"},children:e.jsxs("div",{className:t>=0?"text-success":"text-danger",children:[e.jsx("strong",{children:"当期収支差額:"})," ",m(Math.abs(t))," ",t>=0?"（黒字）":"（赤字）"]})})]})]})},M=({engine:d,division:x,year:g})=>{const i=parseInt(g),u=`${i}-04-01`,E=`${i+1}-03-31`,h=[],N=[],p=[];let b=0,j=0,t=0;const s={rev:0,exp:0},a=new Map;d.journals.forEach(c=>{c.date>=u&&c.date<=E&&c.status==="POSTED"&&c.division===x&&c.details.forEach(l=>{const r=d.accounts.find(B=>B.code===l.accountCode);if(!r)return;let v=a.get(l.accountCode)||0;r.normalBalance==="DEBIT"?(v+=l.debitAmount||0,v-=l.creditAmount||0):(v-=l.debitAmount||0,v+=l.creditAmount||0),a.set(l.accountCode,v)})}),a.forEach((c,l)=>{const r=d.accounts.find(v=>v.code===l);if(!r||c===0)return;const f=Math.abs(c);r.type==="ASSET"&&c>0&&(h.push({code:r.code,name:r.name,amount:f}),b+=f),r.type==="LIABILITY"&&c>0&&(N.push({code:r.code,name:r.name,amount:f}),j+=f),r.type==="EQUITY"&&c>0&&(p.push({code:r.code,name:r.name,amount:f}),t+=f),r.type==="REVENUE"&&c>0&&(s.rev+=f),r.type==="EXPENSE"&&c>0&&(s.exp+=f)});const n=s.rev-s.exp;n!==0&&(p.push({code:"3002",name:"当期収支差額",amount:Math.abs(n)}),t+=Math.abs(n)),h.sort((c,l)=>c.code.localeCompare(l.code)),N.sort((c,l)=>c.code.localeCompare(l.code)),p.sort((c,l)=>c.code.localeCompare(l.code));const o=Math.abs(b-(j+t))<.01;return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("strong",{children:"貸借対照表（区分別）"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("h6",{className:"text-primary",children:"資産の部"}),e.jsx("table",{className:"table table-sm",children:e.jsxs("tbody",{children:[h.length===0?e.jsx("tr",{children:e.jsx("td",{className:"text-muted",children:"資産なし"})}):h.map(c=>e.jsxs("tr",{children:[e.jsx("td",{children:c.name}),e.jsx("td",{className:"text-end",children:m(c.amount)})]},c.code)),e.jsxs("tr",{className:"table-light",children:[e.jsx("td",{children:e.jsx("strong",{children:"資産合計"})}),e.jsx("td",{className:"text-end",children:e.jsx("strong",{children:m(b)})})]})]})})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("h6",{className:"text-warning",children:"負債の部"}),e.jsx("table",{className:"table table-sm",children:e.jsxs("tbody",{children:[N.length===0?e.jsx("tr",{children:e.jsx("td",{className:"text-muted",children:"負債なし"})}):N.map(c=>e.jsxs("tr",{children:[e.jsx("td",{children:c.name}),e.jsx("td",{className:"text-end",children:m(c.amount)})]},c.code)),e.jsxs("tr",{className:"table-light",children:[e.jsx("td",{children:e.jsx("strong",{children:"負債合計"})}),e.jsx("td",{className:"text-end",children:e.jsx("strong",{children:m(j)})})]})]})}),e.jsx("h6",{className:"text-success mt-3",children:"正味財産の部"}),e.jsx("table",{className:"table table-sm",children:e.jsxs("tbody",{children:[p.length===0?e.jsx("tr",{children:e.jsx("td",{className:"text-muted",children:"正味財産なし"})}):p.map(c=>e.jsxs("tr",{children:[e.jsx("td",{children:c.name}),e.jsx("td",{className:"text-end",children:m(c.amount)})]},c.code)),e.jsxs("tr",{className:"table-light",children:[e.jsx("td",{children:e.jsx("strong",{children:"正味財産合計"})}),e.jsx("td",{className:"text-end",children:e.jsx("strong",{children:m(t)})})]})]})})]})]}),e.jsx("div",{className:"text-center mt-2",children:e.jsx("span",{className:o?"text-success":"text-danger",children:o?"✓ 一致":"✗ 不一致"})})]})]})},O=({engine:d})=>{const[x,g]=y.useState("KANRI"),[i,u]=y.useState("2024");return e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"d-flex gap-3",children:[e.jsx(I,{value:x,onChange:g}),e.jsx(D,{value:i,onChange:u})]}),e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsx(T,{engine:d,division:x,year:i})}),e.jsx("div",{className:"col-md-6",children:e.jsx(w,{engine:d,division:x,year:i})}),e.jsx("div",{className:"col-12",children:e.jsx(M,{engine:d,division:x,year:i})})]})]})};export{O as DivisionStatementsPanel};
