import{j as e}from"./assets/index-DNcHv8Gn.js";import{r as g,R as b}from"./chunk-DJ1oPbzn.js";import"./chunk-B6LuprgX.js";const y=({engine:l,onClose:c,onSaved:h})=>{const x=g.useMemo(()=>Array.from(l.unitOwners.values()).map(t=>({unitNumber:t.unitNumber,ownerName:t.ownerName,floor:t.floor,area:t.area,managementFee:t.managementFee,repairReserve:t.repairReserve,contact:t.contact??"",bankAccount:t.bankAccount??"",isActive:t.isActive!==!1})),[l]),[u,o]=g.useState(x),j=()=>o(t=>[...t,{unitNumber:"",ownerName:"",floor:1,area:70,managementFee:0,repairReserve:0,isActive:!0}]),m=t=>o(r=>r.filter((s,d)=>d!==t)),n=(t,r,s)=>o(d=>d.map((a,p)=>p===t?{...a,[r]:s}:a)),i=()=>{const t=new Map;for(const r of u){const s=r.unitNumber.trim();if(!s){alert("部屋番号を入力してください");return}if(!r.ownerName.trim()){alert("所有者名を入力してください");return}if(r.managementFee<0||r.repairReserve<0){alert("金額は0以上で入力してください");return}t.set(s,{...r,unitNumber:s})}l.unitOwners=t,l.rebuildAuxiliaryAccounts(),h(),c(),alert("組合員マスタを更新しました。")};return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.3)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{width:"90%",maxWidth:900,background:"white",borderRadius:8,padding:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{children:"組合員マスタ管理"}),e.jsx("button",{onClick:c,children:"× 閉じる"})]}),e.jsx("div",{style:{margin:"8px 0"},children:e.jsx("button",{onClick:j,children:"新規組合員追加"})}),e.jsx("div",{style:{overflowX:"auto",maxHeight:420},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"部屋番号"}),e.jsx("th",{children:"所有者名"}),e.jsx("th",{children:"階数"}),e.jsx("th",{children:"面積(m²)"}),e.jsx("th",{children:"管理費"}),e.jsx("th",{children:"修繕積立金"}),e.jsx("th",{children:"有効"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:u.map((t,r)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("input",{value:t.unitNumber,onChange:s=>n(r,"unitNumber",s.target.value)})}),e.jsx("td",{children:e.jsx("input",{value:t.ownerName,onChange:s=>n(r,"ownerName",s.target.value)})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:t.floor,onChange:s=>n(r,"floor",Number(s.target.value))})}),e.jsx("td",{children:e.jsx("input",{type:"number",step:.1,value:t.area,onChange:s=>n(r,"area",Number(s.target.value))})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:t.managementFee,onChange:s=>n(r,"managementFee",Number(s.target.value))})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:t.repairReserve,onChange:s=>n(r,"repairReserve",Number(s.target.value))})}),e.jsx("td",{style:{textAlign:"center"},children:e.jsx("input",{type:"checkbox",checked:!!t.isActive,onChange:s=>n(r,"isActive",s.target.checked)})}),e.jsx("td",{children:e.jsx("button",{onClick:()=>m(r),children:"削除"})})]},r))})]})}),e.jsxs("div",{style:{marginTop:8,display:"flex",justifyContent:"flex-end",gap:8},children:[e.jsx("button",{onClick:c,children:"キャンセル"}),e.jsx("button",{onClick:i,children:"変更を保存"})]})]})})},A=({engine:l,onChange:c})=>{const h=l.getUnitReceivablesSummary(),x=l.getAuxiliaryLedgerSummary(),[u,o]=b.useState(!1),j=(()=>{let n=!1;return l.unitOwners.forEach(i=>{i.isActive&&((i.monthlyManagementFee??0)>0||(i.monthlyReserveFund??0)>0)&&(n=!0)}),n})(),m=()=>{var t;const n=new Date;n.toISOString().split("T")[0];const i=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-01`;if(confirm(`${n.getFullYear()}年${n.getMonth()+1}月分の月次請求を作成しますか？`)){let r=0,s=0;if(l.unitOwners.forEach(a=>{a.isActive&&(s++,r+=(Number(a.monthlyManagementFee)||0)+(Number(a.monthlyReserveFund)||0))}),s===0||r===0){alert("月次請求の作成に失敗: 有効な組合員または月額がありません");return}const d=l.createMonthlyBilling(i);d.success?(alert("月次請求を作成しました。補助元帳をご確認ください。"),c()):alert(`月次請求の作成に失敗: ${(t=d.errors)==null?void 0:t.join(", ")}`)}};return e.jsxs("div",{style:{border:"1px solid #ddd",borderRadius:8,padding:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{children:"補助元帳"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{onClick:m,disabled:!j,title:j?void 0:"有効な組合員と月額が必要です（組合員管理で設定）",children:"月次請求作成"}),e.jsx("button",{onClick:()=>o(!0),children:"組合員管理"})]})]}),h.length>0&&e.jsxs("div",{style:{border:"1px solid #ffe08a",background:"#fff7db",borderRadius:8,marginTop:12},children:[e.jsx("div",{style:{padding:"8px 12px",fontWeight:600},children:"部屋別未収金一覧"}),e.jsx("div",{style:{padding:12,overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"部屋番号"}),e.jsx("th",{children:"所有者"}),e.jsx("th",{children:"階"}),e.jsx("th",{style:{textAlign:"right"},children:"未収管理費"}),e.jsx("th",{style:{textAlign:"right"},children:"未収修繕積立金"}),e.jsx("th",{style:{textAlign:"right"},children:"合計"})]})}),e.jsx("tbody",{children:h.map(n=>{const i=n.unitNumber.charAt(0);return e.jsxs("tr",{children:[e.jsx("td",{children:n.unitNumber}),e.jsx("td",{children:n.ownerName}),e.jsxs("td",{style:{textAlign:"center"},children:[i,"F"]}),e.jsxs("td",{style:{textAlign:"right"},children:["¥",Math.abs(n.managementFeeReceivable).toLocaleString()]}),e.jsxs("td",{style:{textAlign:"right"},children:["¥",Math.abs(n.reserveFundReceivable).toLocaleString()]}),e.jsx("td",{style:{textAlign:"right"},children:e.jsxs("strong",{children:["¥",Math.abs(n.totalReceivable).toLocaleString()]})})]},n.unitNumber)})})]})})]}),x.length>0?e.jsxs("div",{style:{border:"1px solid #0dcaf0",borderRadius:8,marginTop:12},children:[e.jsx("div",{style:{background:"#0dcaf0",color:"white",padding:"8px 12px",borderTopLeftRadius:8,borderTopRightRadius:8},children:"補助元帳一覧"}),e.jsx("div",{style:{padding:12,overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"主勘定科目"}),e.jsx("th",{children:"補助科目"}),e.jsx("th",{style:{textAlign:"right"},children:"残高"}),e.jsx("th",{style:{textAlign:"center"},children:"取引数"}),e.jsx("th",{children:"属性"})]})}),e.jsx("tbody",{children:x.flatMap(n=>n.auxiliaries.map(i=>{var d;const t=l.accounts.find(a=>a.code===n.accountCode),r=t==null?void 0:t.getAuxiliaryLedger(i.code),s=[];if((d=r==null?void 0:r.attributes)!=null&&d.owner){const a=r.attributes.owner;s.push(`部屋: ${a.unitNumber}`),s.push(`所有者: ${a.ownerName}`)}return e.jsxs("tr",{children:[e.jsx("td",{children:n.accountName}),e.jsx("td",{children:i.name}),e.jsxs("td",{style:{textAlign:"right",color:i.isDebit?"#0d6efd":"#dc3545"},children:["¥",i.balance.toLocaleString()]}),e.jsx("td",{style:{textAlign:"center"},children:(r==null?void 0:r.transactions.length)||0}),e.jsx("td",{children:e.jsx("small",{style:{color:"#666"},children:s.join(", ")})})]},`${n.accountCode}-${i.code}`)}))})]})})]}):e.jsx("p",{style:{color:"#888",marginTop:12},children:"補助元帳データがありません"}),u&&e.jsx(y,{engine:l,onClose:()=>o(!1),onSaved:c})]})};export{A as AuxiliaryLedgerView};
