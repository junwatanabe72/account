import{j as e}from"./assets/index-DNcHv8Gn.js";import{r as i,R as E}from"./chunk-DJ1oPbzn.js";import{g as z,D as T}from"./chunk-nbQFM0MW.js";import"./chunk-B6LuprgX.js";const W=({value:a,onChange:f})=>e.jsxs("div",{className:"d-flex align-items-center gap-2 mb-2",children:[e.jsx("label",{className:"form-label mb-0",children:"年度"}),e.jsxs("select",{className:"form-select",style:{maxWidth:180},value:a,onChange:p=>f(p.target.value),children:[e.jsx("option",{value:"2023",children:"2023年度"}),e.jsx("option",{value:"2024",children:"2024年度"}),e.jsx("option",{value:"2025",children:"2025年度"})]})]}),F=({engine:a})=>{const f=new Date().getFullYear(),[p,w]=i.useState(String(f)),[c,M]=i.useState("ALL"),A=T,R=z(A),u=i.useMemo(()=>{const d=parseInt(p),t=new Date().getMonth()+1;return{start:`${d}-${String(t).padStart(2,"0")}-01`,end:`${d}-${String(t).padStart(2,"0")}-31`}},[p]),[x,D]=i.useState(u.start),[h,v]=i.useState(u.end);E.useEffect(()=>{D(u.start),v(u.end)},[u]);const S=i.useMemo(()=>{if(c==="ALL")return[...Array.from(a.divisions.values()).map(t=>({code:t.code,name:t.name})),{code:"OTHER",name:"その他"}];{const d=A.find(t=>c==="KANRI"?t.code==="GENERAL":t.code===c);return d?[{code:c==="GENERAL"?"KANRI":c,name:d.name}]:[]}},[a,c,A]),N=i.useMemo(()=>{const d=new Map;return S.forEach(t=>{const r=a.getExpenseDetails(x,h,t.code),n=a.getExpenseDetailSummary(x,h,t.code);(r.length>0||n.length>0)&&d.set(t.code,{name:t.name,details:r,summary:n})}),d},[a,x,h,S]),y=i.useMemo(()=>{const d=new Date(x),t=new Date(h),r=[];let n=new Date(d.getFullYear(),d.getMonth(),1);for(;n<=t;)r.push(n.toISOString().substring(0,7)),n.setMonth(n.getMonth()+1);return r},[x,h]),g=d=>`¥${d.toLocaleString()}`,I=d=>{const[t,r]=d.split("-");return`${t}年${parseInt(r||"0")}月`},L=d=>{const t=new Map;return d.forEach(r=>{if(r.auxiliaryCode){const n=`${r.accountCode}-${r.auxiliaryCode}`,j=r.date.substring(0,7);t.has(n)||t.set(n,new Map);const s=t.get(n);s.set(j,(s.get(j)||0)+r.amount)}}),t},$=d=>{const t=new Date(d),r=new Date(h);if(isNaN(t.getTime())){alert("無効な日付形式です");return}if(t>r){alert("開始日は終了日より前の日付を指定してください");return}D(d)},k=d=>{const t=new Date(x),r=new Date(d);if(isNaN(r.getTime())){alert("無効な日付形式です");return}if(t>r){alert("終了日は開始日より後の日付を指定してください");return}v(d)};return e.jsxs("div",{style:{border:"1px solid #ddd",borderRadius:8,padding:12},children:[e.jsx("h3",{children:"支出明細表"}),e.jsxs("div",{style:{marginBottom:16,display:"flex",gap:12,alignItems:"center",flexWrap:"wrap"},children:[e.jsx(W,{value:p,onChange:w}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("label",{className:"form-label mb-0",children:"会計区分"}),e.jsxs("select",{className:"form-select",style:{maxWidth:250},value:c,onChange:d=>M(d.target.value),children:[e.jsx("option",{value:"ALL",children:"全区分表示"}),R.map(d=>e.jsx("optgroup",{label:d.label,children:d.options.map(t=>{const r=t.code==="GENERAL"?"KANRI":t.code==="SPECIAL_OTHER"?"SPECIAL":t.code;return e.jsx("option",{value:r,children:t.name},t.code)})},d.label))]})]}),e.jsxs("div",{children:[e.jsx("label",{children:"開始日: "}),e.jsx("input",{type:"date",value:x,onChange:d=>$(d.target.value),style:{padding:4,borderRadius:4,border:"1px solid #ccc"}})]}),e.jsxs("div",{children:[e.jsx("label",{children:"終了日: "}),e.jsx("input",{type:"date",value:h,onChange:d=>k(d.target.value),style:{padding:4,borderRadius:4,border:"1px solid #ccc"}})]})]}),Array.from(N.entries()).map(([d,t])=>{const r=L(t.details),n=new Map;t.details.forEach(s=>{const o=s.date.substring(0,7);n.set(o,(n.get(o)||0)+s.amount)});const j=t.summary.reduce((s,o)=>s+o.amount,0);return e.jsxs("div",{style:{marginBottom:48,border:"2px solid #dc3545",borderRadius:8,padding:16},children:[e.jsxs("h3",{style:{color:"#dc3545",marginBottom:16},children:[t.name," 支出明細表"]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("h4",{style:{color:"#dc3545"},children:"支出明細（月次集計）"}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:14},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f8f9fa"},children:[e.jsx("th",{style:{border:"1px solid #ddd",padding:8,textAlign:"left"},children:"科目"}),y.map(s=>e.jsx("th",{style:{border:"1px solid #ddd",padding:8,textAlign:"right",minWidth:100},children:I(s)},s)),e.jsx("th",{style:{border:"1px solid #ddd",padding:8,textAlign:"right",backgroundColor:"#e9ecef"},children:"合計"})]})}),e.jsxs("tbody",{children:[t.summary.map(s=>{const o=new Map;return t.details.filter(l=>l.accountCode===s.accountCode&&!l.auxiliaryCode).forEach(l=>{const m=l.date.substring(0,7);o.set(m,(o.get(m)||0)+l.amount)}),e.jsxs(E.Fragment,{children:[e.jsxs("tr",{children:[e.jsxs("td",{style:{border:"1px solid #ddd",padding:8,fontWeight:"bold"},children:[s.accountCode," ",s.accountName]}),y.map(l=>e.jsx("td",{style:{border:"1px solid #ddd",padding:8,textAlign:"right"},children:o.get(l)?g(o.get(l)):"-"},l)),e.jsx("td",{style:{border:"1px solid #ddd",padding:8,textAlign:"right",fontWeight:"bold",backgroundColor:"#f8f9fa"},children:g(s.amount)})]}),s.auxiliaryDetails&&s.auxiliaryDetails.length>0&&s.auxiliaryDetails.map(l=>{const m=`${s.accountCode}-${l.auxiliaryCode}`,b=r.get(m);return e.jsxs("tr",{style:{backgroundColor:"#f8f9fa"},children:[e.jsxs("td",{style:{border:"1px solid #ddd",padding:"4px 8px 4px 24px",fontSize:12},children:["└ ",l.auxiliaryName]}),y.map(C=>e.jsx("td",{style:{border:"1px solid #ddd",padding:4,textAlign:"right",fontSize:12},children:b!=null&&b.get(C)?g(b.get(C)):"-"},C)),e.jsx("td",{style:{border:"1px solid #ddd",padding:4,textAlign:"right",fontSize:12},children:g(l.amount)})]},m)})]},s.accountCode)}),e.jsxs("tr",{style:{backgroundColor:"#e9ecef",fontWeight:"bold"},children:[e.jsx("td",{style:{border:"1px solid #ddd",padding:8},children:"支出合計"}),y.map(s=>e.jsx("td",{style:{border:"1px solid #ddd",padding:8,textAlign:"right"},children:n.get(s)?g(n.get(s)):"-"},s)),e.jsx("td",{style:{border:"1px solid #ddd",padding:8,textAlign:"right",fontSize:16},children:g(j)})]})]})]})})]}),e.jsxs("div",{children:[e.jsx("h4",{style:{color:"#dc3545"},children:"支出明細（詳細）"}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f8f9fa"},children:[e.jsx("th",{style:{border:"1px solid #ddd",padding:6,textAlign:"left"},children:"日付"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:6,textAlign:"left"},children:"伝票番号"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:6,textAlign:"left"},children:"科目"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:6,textAlign:"left"},children:"摘要"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:6,textAlign:"left"},children:"補助元帳"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:6,textAlign:"right"},children:"金額"})]})}),e.jsx("tbody",{children:t.details.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,style:{border:"1px solid #ddd",padding:16,textAlign:"center",color:"#888"},children:"該当する支出データがありません"})}):t.details.map((s,o)=>e.jsxs("tr",{children:[e.jsx("td",{style:{border:"1px solid #ddd",padding:6},children:s.date}),e.jsx("td",{style:{border:"1px solid #ddd",padding:6},children:s.journalNumber}),e.jsxs("td",{style:{border:"1px solid #ddd",padding:6},children:[s.accountCode," ",s.accountName]}),e.jsx("td",{style:{border:"1px solid #ddd",padding:6},children:s.description}),e.jsx("td",{style:{border:"1px solid #ddd",padding:6},children:s.auxiliaryName||"-"}),e.jsx("td",{style:{border:"1px solid #ddd",padding:6,textAlign:"right"},children:g(s.amount)})]},o))})]})})]})]},d)}),N.size===0&&e.jsx("div",{style:{textAlign:"center",padding:32,color:"#888"},children:"指定期間内に支出データがありません"})]})};export{F as ExpenseDetailView};
