# Phase 14 テストフロー手順書

## 🎯 テスト概要
Phase 14で実装した銀行入金処理と未収金管理機能の動作確認手順書です。

## 📍 テストページへのアクセス

### 1. アプリケーション起動
```bash
cd /Users/junwatanabe72/Documents/mockup/account
npm run dev
```

### 2. ブラウザでアクセス
```
http://localhost:5173/
```

### 3. テストパネルへ移動
1. 左側のサイドバーで「**データ管理**」セクションを展開
2. 「**🧪 Phase14テスト**」をクリック

---

## ✅ クイックテスト（推奨）

### 🚀 完全自動テスト
1. **Phase14テスト**ページを開く
2. 「**テスト実行**」タブが選択されていることを確認
3. 緑色の「**🚀 完全テスト実行**」ボタンをクリック

#### 期待される結果
```
🚀 完全テストフロー開始
1️⃣ データクリア完了
✅ サンプルCSV読み込み完了
✅ 自動インポート完了: 10件
✅ 照合処理完了
📊 照合結果: 10件
✅ 未収金作成: rcv_xxx
5️⃣ サマリー更新完了
🎉 完全テストフロー完了！
```

---

## 📝 個別機能テスト

### テスト1: CSVインポート

#### 手順
1. 「**インポート**」タブをクリック
2. 銀行タイプで「**汎用**」を選択
3. 青色の「**📁 サンプルCSV読込**」ボタンをクリック
4. 「**インポート実行**」ボタンをクリック

#### 確認ポイント
- ✅ インポート成功メッセージが表示される
- ✅ 下部の表に銀行取引が表示される
- ✅ 各取引の状態が「unprocessed」になっている

#### サンプルデータの内容
| 日付 | 摘要 | 入金額 | テストケース |
|------|------|--------|------------|
| 2024-04-25 | 管理費 101号室 田中様 | 28,000 | 正常入金 |
| 2024-04-25 | 管理費・修繕費 202号室 山田 | 35,000 | 正常入金 |
| 2024-04-26 | 303 サトウ | 20,000 | 一部入金 |
| 2024-04-26 | 管理費等 305号室 | 28,000 | 正常入金 |
| 2024-04-26 | カンリヒ 401 | 15,000 | 一部入金 |
| 2024-04-28 | 入金者不明 4月分 | 25,000 | 住戸不明 |

---

### テスト2: 入金照合処理

#### 手順
1. CSVインポート完了後、「**テスト実行**」タブに戻る
2. 紫色の「**🔍 全取引照合**」ボタンをクリック

#### 確認ポイント
- ✅ 照合処理完了メッセージが表示される
- ✅ 各取引の照合タイプが表示される
  - `exact`: 完全一致（緑）
  - `partial`: 一部入金（黄）
  - `over`: 過入金（青）
  - `unidentified`: 不明（赤）

#### 照合結果の確認
1. 「**照合結果**」タブをクリック
2. 表で以下を確認：
   - 住戸番号が正しく抽出されている
   - 照合タイプが適切に判定されている
   - 差額が正しく計算されている
   - 信頼度が表示されている

---

### テスト3: 未収金管理

#### 未収金の作成
1. 「**テスト実行**」タブで黄色の「**💰 未収金作成**」ボタンをクリック
2. コンソールに作成成功メッセージが表示される

#### 未収金一覧の確認
1. 「**未収金**」タブをクリック
2. 表で以下を確認：
   - 住戸番号（101号室）
   - 科目（管理費/修繕積立金/駐車場）
   - 金額
   - 期日
   - 状態（outstanding/partially_paid/paid）

#### 未収金サマリーの確認
- 総未収金額が表示される
- 対象住戸数が表示される
- 延滞期間別の金額が表示される

---

### テスト4: 摘要解析のテスト

#### 様々なパターンの確認
Phase 14は以下の摘要パターンを認識します：

| 摘要例 | 抽出される住戸番号 |
|--------|------------------|
| 101号室 | 101 |
| 202号 | 202 |
| 303ゴウ | 303 |
| Room 404 | 404 |
| 部屋番号505 | 505 |
| #606 | 606 |
| 田中様 | （名前から検索） |

---

## 🔧 トラブルシューティング

### エラー: Services not initialized
**原因**: Payment Servicesが初期化されていない
**解決**: ページをリロードする

### エラー: ファイルが選択されていません
**原因**: CSVファイルを選択せずにインポートボタンを押した
**解決**: 「📁 サンプルCSV読込」ボタンでサンプルを読み込む

### データが表示されない
**原因**: LocalStorageにデータが保存されていない
**解決**: 「🗑️ データクリア」後、再度インポート

---

## 📊 テスト結果の確認方法

### コンソールログ
- 黒背景のコンソールエリアにすべての操作ログが表示されます
- 緑色の ✅ は成功
- 赤色の ❌ はエラー
- 黄色の ⚠️ は警告

### データの永続性確認
1. データをインポート後、ページをリロード
2. Phase14テストページを再度開く
3. 各タブでデータが保持されていることを確認

---

## 🎬 デモシナリオ

### シナリオ1: 正常な入金処理
1. 完全テスト実行
2. 照合結果タブで「101号室」の行を確認
3. 照合タイプが「exact」（完全一致）であることを確認

### シナリオ2: 一部入金の処理
1. 照合結果タブで「303号室」の行を確認
2. 照合タイプが「partial」（部分入金）
3. 差額が赤字で表示されることを確認
4. 未収金タブで303号室の未収金が作成されていることを確認

### シナリオ3: 住戸不明の処理
1. 照合結果タブで「住戸：不明」の行を確認
2. 照合タイプが「unidentified」
3. 信頼度が0%であることを確認

---

## 📈 パフォーマンステスト

### 大量データ処理
1. 100件以上のCSVをインポート
2. 処理時間が5秒以内であることを確認
3. UIがフリーズしないことを確認

---

## ✔️ チェックリスト

### 基本機能
- [ ] CSVインポートが成功する
- [ ] 重複チェックが機能する
- [ ] 照合処理が完了する
- [ ] 未収金が作成される
- [ ] データが永続化される

### 照合精度
- [ ] 住戸番号が正しく抽出される
- [ ] 標準請求額との差額が正しい
- [ ] 照合タイプが適切
- [ ] 信頼度スコアが妥当

### UI/UX
- [ ] タブ切り替えがスムーズ
- [ ] エラーメッセージが分かりやすい
- [ ] 処理中の表示がある
- [ ] データが見やすく表示される

---

## 🚨 既知の問題

1. **ビルド警告**: チャンクサイズが大きい（768KB）
   - 影響: 初回ロードが遅い可能性
   - 対策: 将来的にコード分割を検討

2. **型エラー**: 既存プロジェクトに型エラーあり
   - 影響: Phase 14の動作には影響なし
   - 対策: 別途修正が必要

---

## 📞 サポート

問題が発生した場合は、以下を確認してください：

1. ブラウザのコンソール（F12）でエラーを確認
2. LocalStorageをクリア（開発者ツール > Application > Local Storage）
3. ページをリロード
4. npm run devを再起動

---

*このテストフローは Phase 14 - 1st Implementation の動作確認用です*
*最終更新: 2025年1月21日*